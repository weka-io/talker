language: python
matrix:
  include:
    - stage: client unit tests
      python: 3.4
      env:
        - TEST_SUITE="tests/uts/test_client.py"
    - python: 3.5
      env:
        - TEST_SUITE="tests/uts/test_client.py"
    - python: 3.6
      env:
        - TEST_SUITE="tests/uts/test_client.py"
    - python: 3.7
      env:
        - TEST_SUITE="tests/uts/test_client.py"
    - stage: agent unit tests
      python: 3.5
      env:
        - TEST_SUITE="tests/uts/test_agent.py"
    - stage: integration tests
      python: 3.4
      env:
        - TEST_SUITE="tests/integration"
      before_install:
        - tests/integration/setup.sh
    - python: 3.5
      env:
        - TEST_SUITE="tests/integration"
      before_install:
        - tests/integration/setup.sh
    - python: 3.6
      env:
        - TEST_SUITE="tests/integration"
      before_install:
        - tests/integration/setup.sh
    - python: 3.7
      env:
        - TEST_SUITE="tests/integration"
      before_install:
        - tests/integration/setup.sh
script: pytest $TEST_SUITE -v
dist: xenial
install:
  - pip install .[test]
deploy:
  provider: pypi
  user: __token__
  password:
    secure: IbmdvH5PFfU74iQjRgtx6/dMbQIv+kSQhxOmPsB3KA7NGWWSeSn2Vjm8kb457x5Tau/rZwG8z6Q2lbbkgylAZ2H9OWUMw60ZtPJK351EGdljLqSFoaFxg60U7a8+dwSjhX91bRgqNYLF03oviRgVloYc/8/1b84tGFVelAJ6khZE+Ll6ndsqEtsCh9zSkd+PMlOWYTOhxUZu5hYUfpnwN1acnfhuNjGBlqvqTIA9ErTOxt50g0EBUT0Mzlkq0Wb70RaT6NCAI5NHIz/ZyVnk8hANyldoiuCpMsxSCq/DcQClHRiSDBo3sf9Glkeqk/tN0L1ZCT+ADxOs529Sj0got8VtlLY/qXRnUD+KqDXCEvtoLoGQantaG/HsFvESEHCdGo9EqHtPjLvhRQDZC/DxwUmCV2qKjtlrv/UflDLEg3cBKlDjLFzUFiliwjcJ3/Z9ljX5nm7k8/v4e014kncH6lBH2/wj7VhSBJ+6RM4mcocQt6wGdnWoc+66CO8PHKsjdTvasEp4V0D1WJqZN5n4W21L5vnQnUgSJ27eS8OZxWfnFZpzUnc4o67N32IOVKoZgnSY2TV/KXkZj4usEevDDtimH9fXAqImCZPyXc7Um/hP7YOiINGci18fOUFniDpJEIUIpm9K0Eu3s0JoFU2t4YxT68D7oThWwwY8PVJi+JI=
  skip_cleanup: true
  on:
    tags: true
    branch: master
  skip_existing: true
notifications:
  slack:
    secure: jSvGUdxwajD0ERxNzqLQ9lIIbK0xLMN1+asXiED/NMUU7BHnX4SGYUltHN7RxXuPIcHX/zd9UhDTnXBZMEee8JQ2XEfJGrfsivWjG7EVL9tRoIjsorNhPOm+WZF7w8CQ23is1PlDDT7RjiGr/EtxaCDkq1evGqYPJwgpTXL8fMuHPdHMHGBjHMAGMavoR2u6ZtbSs3RZc0i/n5oqFiRRmhsuZIdRLKlMqDEyac0k1tpvZurJW3BmoZsXLYramXVXlKBZ5q5oTRAZF5XUFQIIfbxJRrTE2Bkk+CAiCA80RjRONgCykFQkgg/PcD+ZlobAAj1lbwfXmp7o/hv3bBruSQ/E+XmxN0BXS3QDoejxDqunm9N2WBivqc6mu8nOZUKmwY+pZVRglYA4xRwGo1ZJ2nmymmu1U44mgNUboea42Rl1DAJSbfdUFnqT9y1BLNNpepg8FUlqFRQYZxm4pGf1i2UCMXlp2Xvw7eVirdlz8ySUMSGDG/t9qm2TytSRL4MKlnoesjTDXhPGtjpubN86QjOrvmF/34MzjHe7lOagZNXlpOsSiQGl3tvo2lm6ln+QJCtqvWzE/qtDg+p3o1BMuvNPYrFG1lJkN636lvmErEZLOI9fSvRrpLf2deTqZ1+od9+iofJi8vSQRZXjLtfkcw+yyzddhegk4jJ6JNCBdJQ=
